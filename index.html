<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Commentboard üêù</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 2rem auto;
    background: #222;
    color: #e0e0e0;
    transition: background 0.3s ease, color 0.3s ease;
  }
  
  body.light-mode {
    background: #fafafa;
    color: #222;
  }
  
  #messages {
    border: 1px solid #444;
    padding: 1rem;
    height: 300px;
    overflow-y: auto;
    background: #333;
    margin-bottom: 1rem;
    border-radius: 8px;
    transition: background 0.3s ease, border-color 0.3s ease;
  }
  
  body.light-mode #messages {
    border: 1px solid #ddd;
    background: #fff;
  }
  
  .message {
    padding: 0.5rem 0;
    border-bottom: 1px solid #555;
  }
  
  body.light-mode .message {
    border-bottom: 1px solid #eee;
  }
  
  .name {
    font-weight: bold;
    color: #4db6ac;
  }
  
  body.light-mode .name {
    color: #2b7a78;
  }
  
  input, button {
    padding: 0.5rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #555;
    transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
  }
  
  body.light-mode input,
  body.light-mode button {
    border: 1px solid #ccc;
  }
  
  input {
    width: calc(50% - 12px);
    margin-right: 0.5rem;
    background: #444;
    color: #e0e0e0;
  }
  
  body.light-mode input {
    background: #fff;
    color: #222;
  }
  
  button {
    cursor: pointer;
    background-color: #4db6ac;
    color: white;
    border: none;
  }
  
  button:hover {
    background-color: #26a69a;
  }
  
  body.light-mode button {
    background-color: #3aafa9;
  }
  
  body.light-mode button:hover {
    background-color: #2b7a78;
  }
  
  .theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4db6ac;
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }
  
  .theme-toggle:hover {
    background-color: #26a69a;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }
  
  body.light-mode .theme-toggle {
    background-color: #3aafa9;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  body.light-mode .theme-toggle:hover {
    background-color: #2b7a78;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
</style>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
<button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è Light Mode</button>
<h1>Commentboard üêù</h1>
<div id="messages"></div>
<input id="nameInput" placeholder="Your name (optional)" autocomplete="off" />
<input id="messageInput" placeholder="Type your message..." autocomplete="off" />
<button id="sendBtn">Send</button>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAR-xyDfLRoh3VGhQ9988-4RImmxWbbXh4",
    authDomain: "commentboard-8e0b0.firebaseapp.com",
    projectId: "commentboard-8e0b0",
    storageBucket: "commentboard-8e0b0.firebasestorage.app",
    messagingSenderId: "514093341301",
    appId: "1:514093341301:web:ec27bf7ad2b52887abb63c",
    measurementId: "G-BRETTLSML1"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const messagesEl = document.getElementById('messages');
  const nameInput = document.getElementById('nameInput');
  const messageInput = document.getElementById('messageInput');
  const sendBtn = document.getElementById('sendBtn');
  
  // Theme toggle functionality
  function toggleTheme() {
    const body = document.body;
    const themeToggle = document.querySelector('.theme-toggle');
    
    body.classList.toggle('light-mode');
    
    if (body.classList.contains('light-mode')) {
      themeToggle.textContent = 'üåô Dark Mode';
      localStorage.setItem('theme', 'light');
    } else {
      themeToggle.textContent = '‚òÄÔ∏è Light Mode';
      localStorage.setItem('theme', 'dark');
    }
  }
  
  // Load saved theme on page load
  function loadTheme() {
    const savedTheme = localStorage.getItem('theme');
    const body = document.body;
    const themeToggle = document.querySelector('.theme-toggle');
    
    if (savedTheme === 'light') {
      body.classList.add('light-mode');
      themeToggle.textContent = 'üåô Dark Mode';
    } else {
      // Default to dark mode
      themeToggle.textContent = '‚òÄÔ∏è Light Mode';
    }
  }
  
  // Initialize theme when page loads
  loadTheme();
  
  // Notification system variables
  let hasUnreadMessages = false;
  let isPageVisible = true;
  let messageCount = 0;
  const originalTitle = "Commentboard üêù";
  
  // Update tab title based on notification state
  function updateTabTitle() {
    if (hasUnreadMessages && !isPageVisible) {
      document.title = "üî¥" + originalTitle;
    } else {
      document.title = originalTitle;
    }
  }
  
  // Handle page visibility changes
  document.addEventListener('visibilitychange', () => {
    isPageVisible = !document.hidden;
    if (isPageVisible) {
      hasUnreadMessages = false;
      updateTabTitle();
    }
  });
  
  // Handle window focus/blur for better notification support
  window.addEventListener('focus', () => {
    isPageVisible = true;
    hasUnreadMessages = false;
    updateTabTitle();
  });
  
  window.addEventListener('blur', () => {
    isPageVisible = false;
  });
  
  function displayMessage({ name, text }) {
    const div = document.createElement('div');
    div.className = 'message';
    div.innerHTML = `<span class="name">${escapeHtml(name || 'Anonymys')}:</span> ${escapeHtml(text)}`;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  
  function escapeHtml(str) {
    return str.replace(/[&<>"']/g, (m) => ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    })[m]);
  }
  
  db.collection('messages')
    .orderBy('timestamp')
    .onSnapshot(snapshot => {
      const newMessageCount = snapshot.size;
      
      // Check if this is a new message (not initial load)
      if (messageCount > 0 && newMessageCount > messageCount && !isPageVisible) {
        hasUnreadMessages = true;
        updateTabTitle();
      }
      
      messageCount = newMessageCount;
      messagesEl.innerHTML = '';
      snapshot.forEach(doc => displayMessage(doc.data()));
    });
  
  sendBtn.onclick = () => {
    const name = nameInput.value.trim() || 'Anonymys';
    const text = messageInput.value.trim();
    if (!text) return;
    sendBtn.disabled = true;
    db.collection('messages').add({
      name,
      text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
      messageInput.value = '';
      sendBtn.disabled = false;
      messageInput.focus();
    }).catch(() => {
      alert('Error sending message, try again!');
      sendBtn.disabled = false;
    });
  };
  
  messageInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendBtn.click();
  });
</script>
</body>
</html>
